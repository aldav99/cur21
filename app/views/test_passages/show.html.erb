<h1>Passing the <%= @test_passage.test.title %> Test</h1>


<div><%=t('time_test')%> <span id="time"><%=javascript_tag "localStorage['test_finish_time']"%></span> </div>


<script>
  function startTimer(duration, display) {
      var timer = duration, minutes, seconds;
      setInterval(function () {
          minutes = parseInt(timer / 60, 10)
          seconds = parseInt(timer % 60, 10);

          minutes = minutes < 10 ? "0" + minutes : minutes;
          seconds = seconds < 10 ? "0" + seconds : seconds;

          display.textContent = minutes + ":" + seconds;

          --timer;

          localStorage.setItem('test_finish_time', timer);

          if (timer < 0) {
            localStorage.removeItem("test_finish_time");
            url = window.location + '/result'
            window.location.replace(url);
          }
      }, 1000);
  }
  
  window.onload = function () {
    string1 = document.referrer;
    string2 = "test_passages";
    if(string1.indexOf(string2) < 0) localStorage['test_finish_time'] = <%= @test_passage.test.timer * 60 %>;
    var timer = localStorage['test_finish_time'];
    display = document.querySelector('#time');
    console.log(window.location);
    startTimer(timer, display);
  };
</script>


<p>
  <b><%= @test_passage.current_question.body %></b>
</p>

<p>
  Question <%=@test_passage.current_number_question %> from <%= @test_passage.test.questions.count %>
</p>


<%= render 'shared/progress', width: ((@test_passage.current_number_question - 1)*100/(@test_passage.test.questions.count)) %> 


<%= form_with url: test_passage_path(@test_passage), local: true, method: :put, class: 'open-document' do |form| %>
  <%= form.collection_check_boxes :answer_ids, @test_passage.current_question.answers, :id, :body, include_hidden: false do |b| %>
    <p>
      <%= b.check_box id: "answer_ids_#{b.object.id}" %>
      <%= b.label %>
    </p>
  <% end %>

  <p><%= link_to 'Gist Question', gist_test_passage_path(@test_passage), method: :post %></p>
  <p><%= form.submit 'Next',
                    data: { current_number: @test_passage.current_number_question,
                      total_count: @test_passage.test.questions.count },
                    class: "progress-bar" %></p>
<% end %>
